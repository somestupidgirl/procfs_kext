<img src="https://repository-images.githubusercontent.com/404712610/5dd1f3f4-0118-4fc2-8214-bec1166e80d7">

# IMPORTANT: As of 27 September 2021, latebloom is deprecated.  [Click here for more information.](https://github.com/reenigneorcim/SurPlus)
Many unsupported Macs, both genuine and Hackintosh, have difficulty booting MacOS Big Sur 11.3 and later (including all versions of Monterey to date). The symptom is that at a usually-consistent point in the boot process, the boot simply hangs. To date, no one has definitively determined the exact cause of these hangs, despite many theories being presented. Through trial and error experimentation, I have discovered that introducing a delay during enumeration of the PCIe buses seems to help mitigate the problem, without really shedding any light on the underlying cause. This kext, , dynamically patches the MacOS kernel (actually, the IOPCIFamily.kext code) to introduce a delay into the PCIe bus enumeration loop. Because the true problem may be the result of a race condition, latebloom supports random delays within a specified range, which may help avoid deadlock conditions.

This kext's ability to inject its code is dependent upon finding a certain code pattern in the IOPCIFamily.kext code. As new versions of MacOS are released, new patterns may need to be added to the code in order for latebloom to support those new versions.

The latebloom kext is only active during PCIe bus enumeration, which appears to only happen once, during the early boot process. After that, the kext is dormant, taking up a small amount of memory and never executing any code. At present, no unloading mechanism is in place, so unloading the latebloom kext contains an element of risk - if latebloom is unloaded, the patched IOPCIFamily.kext code will point to memory that has been freed (and possibly reused), which would be a problem if the PCIe bus enumeration code ever executed again. Fortunately, it appears that the code in question only executes during early boot, so while unloading latebloom produces an unclean result, the actual risk of a kernel panic or other disastrous outcome is small. If it ever becomes desirable or necessary to unload the latebloom kext, some cleanup code will need to be added.

The code in this project contains various known inefficiencies. It began its existence as a quick and dirty hack, and those origins still show. Because it only executes once, and its purpose is to add imprecise delays, I have never found it worthwhile to clean up the code and optimize it.

Please see <a href="https://forums.macrumors.com/threads/latebloom-an-experimental-workaround-for-the-11-3-race-condition.2303986/" target="_blank">this thread on MacRumors</a> for more details and discussion.
